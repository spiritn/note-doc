分布式系统中为了解决单点问题，会把数据复制到其他机器上，满足故障恢复和负载均衡的需求。

复制是redis哨兵和集群等高可用的基础。



配置主从节点，可以实现读写分离，多个从节点分担读的压力。

# 配置和使用

1. 建立复制

分为主节点（master）和从节点（slave），一个主节点可以有多个从节点，复制是单向的，即只能由主节点复制到从节点。



开启复制是在从节点上进行的，可以运行期动态指定，也可以在配置文件里指定：

- - 在配置文件中加入 slave of masterHost masterPort
  - 在启动时指定`./redis-server --slave of masterHost masterPort`
  - 运行时动态的使用命令`slave of masterHost masterPort`

`info replication`可以查看复制节点的信息

如果主节点开启了密码，需要在从节点配置masterauth参数



默认情况下从节点是只读的，建议不要修改，因为复制是单向的，从节点修改了值会造成主从不一致。



主从节点一般部署在不同机器上，复制时就会存在网络延迟。redis提供了repl-disable-tcp-nodelay，默认关闭，表示主节点的命令无论大小会立即发往从节点，但是这样增加了网络带宽消耗。开启后，主节点会合并较小的tcp包来节省带宽，但也就造成了主从之间的延迟。一般默认即可，因为机器一般部署同一机房。



1. 断开复制

`slaveof no one`可以断开复制

也可以`slaveof new_master_host new_master_port`复制自一个新的主节点，即切主，注意切主后会清空之前的数据，千万不要误操作输错主节点



redis主从架构可以采用一主一从，也可以一主多从，也可以树状主从，降低主节点压力。