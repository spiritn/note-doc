## 一次线上FullGC

现象：监控告警提示fullGC次数异常增加，几分钟就一次fullGC。排查过程中业务通知发送物品失败
排查：1. 既然是FULL GC，那就把内存dump出来（公司正好提供的工具，会暂时摘除线上流量），但是堆空间200M并不大，堆外内存1.5M也不大，看不出有啥问题。2. 查看日志，有error提示元空间溢出，查看设置的256M，然后查看堆栈信息，找到可疑代码给大象发消息，new NotifyClient 。
3.查看JVM内存监控，发现元空间在上次发布后4天内是不断增长的，基本上10个小时增长10%（元空间大小设置的256M）

线下复显： 没有复现出来，但基本确定问题
解决：确定可疑代码但是线下没有复现，所以决定先重启，元空间恢复正常。晚上正好发布，把代码改成单例Bean（本来也应该这样写）。第二天观察元空间基本不变，稳定在20% 左右。仍需要再观察几天

事后分析：
原因：一位外包同事写的代码，就是发消息RPC调用，用到client，他每次调用都重新new client，里面会通过反射创建Thrift类，属性相同但是类名不同，导致不断加载类到元空间，，然后4天后导致元空间溢出，爆发出问题
